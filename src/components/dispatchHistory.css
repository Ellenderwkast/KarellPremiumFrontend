.dispatch-history {
	margin: 1.25em 0 0 0;
	position: relative;
	padding: 0;
	box-sizing: border-box;
	z-index: 5;
	/* Make the history area use the parent's content width so it stays inside the card */
	margin-left: 0;
	width: 100%;
	max-width: 100%;
}

/* Hide the legacy table view (we use cards as primary UI). Keep in DOM for accessibility/debug. */
.history-table-wrapper { display: none; }
/* Ensure TableContainer can scroll horizontally inside the card instead of creating a page-level scrollbar */
.MuiTableContainer-root { overflow-x: auto; }

.history-table { width: 100%; border-collapse: collapse; background: transparent; box-shadow: none; border-radius: 8px; min-width: 0; table-layout: fixed; }
.history-table th, .history-table td { padding: 10px 14px; border: none; text-align: left; font-size: 0.95em; vertical-align: top; }
.history-table th { background: #2563eb; color: #fff; font-weight: 600; }
.history-table tr:nth-child(even) td { background: #f9f9fb; }
.history-table tr:hover td { background: #e3eaff; }

/* Make long text wrap and avoid overflow */
.history-table td, .history-table th { word-break: break-word; white-space: normal; }

/* Column width tuning to avoid wide table */
.history-table th.col-fecha, .history-table td.col-fecha { width: 12%; max-width: 12%; }
.history-table th.col-dest, .history-table td.col-dest { width: 34%; max-width: 34%; }
.history-table th.col-ref, .history-table td.col-ref { width: 20%; max-width: 20%; }
.history-table th.col-resp, .history-table td.col-resp { width: 26%; max-width: 26%; }
.history-table th.col-acc, .history-table td.col-acc { width: 8%; max-width: 8%; text-align: right; }

/* Give the Response column more room but allow wrap */
.history-table td:nth-child(10), .history-table th:nth-child(10) { max-width: 320px; }

/* Small screens: allow horizontal scroll but make table readable */
@media (max-width: 900px) {
	.history-table { min-width: 0; }
}

/* Truncate long text and show full via title tooltip */
.cell-truncate { display: inline-block; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; max-width: 100%; vertical-align: middle; }
.cell-response { max-width: 360px; display: inline-block; }

/* On small screens hide less important columns to avoid horizontal overflow */
@media (max-width: 900px) {
	/* hide: Producto (2), Ciudad Origen (3), Ciudad Destino (4), Unidades (7), Valor declarado (8), Estado (9) */
	.history-table th:nth-child(2), .history-table td:nth-child(2),
	.history-table th:nth-child(3), .history-table td:nth-child(3),
	.history-table th:nth-child(4), .history-table td:nth-child(4),
	.history-table th:nth-child(7), .history-table td:nth-child(7),
	.history-table th:nth-child(8), .history-table td:nth-child(8),
	.history-table th:nth-child(9), .history-table td:nth-child(9) {
		display: none;
	}

	.cell-truncate { max-width: 200px; }
	.history-table th, .history-table td { padding: 8px 10px; font-size: 0.92em; }
}

/* Ensure table background and shadow sit inside wrapper to avoid overlapping other panels */
.history-table-wrapper { background: #fff; box-shadow: 0 2px 8px rgba(0,0,0,0.06); }
.history-table { background: transparent; }

/* Cards for small screens */
.history-cards {
	display: grid;
	grid-template-columns: repeat(auto-fill, minmax(340px, 1fr));
	gap: 12px;
	margin-top: 8px;
}
.history-card {
	background: #fff;
	border-radius: 8px;
	padding: 12px;
	box-shadow: 0 2px 10px rgba(16,24,40,0.06);
	border: 1px solid var(--gray-200, #eee);
	display: flex;
	flex-direction: column;
}
.card-row { margin-bottom: 8px; color: #222; font-size: 0.95em; }
.card-row strong { width: 110px; display: inline-block; color: #444; font-weight: 700; }
.card-actions { display:flex; gap:8px; margin-top:8px; justify-content: flex-end; }
.btn-link { background: transparent; border: none; color: #2563eb; cursor: pointer; padding: 6px 8px; }
.btn-action { background: #d32f2f; color: #fff; border:none; padding:6px 10px; border-radius:6px; cursor:pointer; }
.btn-action.small { padding:4px 8px; font-size:0.95em; }

/* Responsive: on very small screens make single column and remove left offset */
@media (max-width: 900px) {
	.dispatch-history { margin-left: 0; width: 100%; padding: 0 12px; }
	.history-cards { grid-template-columns: 1fr; }
}

/* Styles for the portal modal (professional) */
.modal-portal-backdrop {
	position: fixed;
	inset: 0;
	display: flex;
	align-items: center;
	justify-content: center;
	background: rgba(2,6,23,0.5);
	z-index: 1000001 !important;
	padding: 24px;
}
.modal-card {
	width: min(920px, 98%);
	max-width: 920px;
	max-height: 88vh;
	background: linear-gradient(180deg,#fff,#fbfdff);
	border-radius: 12px;
	box-shadow: 0 24px 60px rgba(2,6,23,0.3);
	border: 1px solid rgba(16,24,40,0.06);
	overflow: hidden;
	display: flex;
	flex-direction: column;
}
.modal-card-header {
	display:flex;
	align-items: center;
	justify-content: space-between;
	gap: 12px;
	padding: 12px 16px;
	border-bottom: 1px solid rgba(16,24,40,0.06);
	background: linear-gradient(180deg, rgba(255,255,255,0.6), rgba(255,255,255,0.4));
}
.modal-card-title { flex:1 1 auto; min-width:0; }
.title-main { font-weight:800; font-size:16px; color:#0f172a; }
.title-meta { color:#6b7280; font-size:0.88em; margin-top:4px; }
.modal-card-actions { display:flex; gap:8px; align-items:center; }
.btn-icon { background: transparent; border: none; cursor: pointer; padding:6px 8px; border-radius:8px; font-size:14px; }
.btn-icon:hover { background: rgba(15,23,42,0.04); }
.modal-card-body { padding: 14px 16px; overflow: hidden; }
.modal-card .detail-grid { max-height: calc(88vh - 110px); overflow:auto; padding-right:6px; }

/* Force the detail table to be layout-fixed so long values don't expand the modal */
.detail-table { width: 100%; border-collapse: collapse; table-layout: fixed; }
.detail-table th { width: 200px; max-width: 200px; vertical-align: top; }
.detail-table td { overflow-wrap: anywhere; word-break: break-word; max-width: 100%; }

/* Ensure pre content wraps and doesn't push modal wider; allow internal horizontal scroll as fallback */
.detail-table pre.mono { white-space: pre-wrap; overflow-wrap: anywhere; word-break: break-word; max-width: 100%; overflow-x: auto; margin: 0; }

/* If a single value is excessively long, make the td scroll instead of expanding layout */
.detail-table td { max-height: 60vh; overflow: auto; }

/* compact icon buttons */
.btn-icon { width:36px; height:36px; display:inline-flex; align-items:center; justify-content:center; }

@media (max-width: 640px) {
	.modal-card { width: 98%; height: 96vh; border-radius: 10px; }
	.modal-card .detail-grid { max-height: calc(96vh - 120px); }
}

/* Modal */
.modal-backdrop { position: fixed; inset: 0; background: rgba(0,0,0,0.42); z-index: 1000001 !important; padding: 20px; }
.modal { position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); background: linear-gradient(180deg, #ffffff 0%, #fbfdff 100%); width: min(920px, 94%); max-width: 920px; border-radius: 12px; box-shadow: 0 18px 50px rgba(2,6,23,0.28); overflow: hidden; max-height: 88vh; border: 1px solid rgba(16,24,40,0.06); }
.modal-header { display:flex; align-items:center; justify-content:space-between; padding:12px 16px; border-bottom:1px solid rgba(16,24,40,0.06); gap:12px; }
.modal-title { flex: 1 1 auto; min-width: 0; }
.modal-title h4 { margin:0; font-size:17px; color:#0f172a; font-weight:800; }
.modal-meta { color: #6b7280; font-size:0.88em; margin-top:6px; }
.modal-actions { display:flex; gap:8px; align-items:center; flex: 0 0 auto; }
.modal-close { background: transparent; border: 0; font-weight:700; cursor: pointer; color: #374151; padding:6px 8px; border-radius:8px; font-size:0.95em; }
.modal-close:hover { background: rgba(15,23,42,0.04); }
.btn-secondary { background: transparent; border: 1px solid rgba(15,23,42,0.08); padding:6px 10px; border-radius:8px; cursor:pointer; color:#111827; font-weight:600; font-size:0.95em; }
.btn-secondary:hover { background: rgba(15,23,42,0.03); }

/* Small modifier for more compact buttons */
.btn-secondary.small, .modal-close.small { padding:4px 8px; font-size:0.9em; }

/* Ensure modal and backdrop are above any widget with high z-index */
.modal, .modal-backdrop { z-index: 1000001 !important; }
.modal-body { padding: 18px 20px; }
.detail-grid { display:block; max-height: calc(92vh - 160px); overflow:auto; padding-right:6px; }
.detail-table { width: 100%; border-collapse: collapse; }
.detail-table th { text-align: left; vertical-align: top; padding: 10px 14px; width: 220px; color: #111827; background: #f8fafc; font-weight:700; }
.detail-table td { padding: 10px 14px; color: #0f172a; }
.mono { font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, 'Roboto Mono', 'Courier New', monospace; font-size: 13px; color: #0b1220; background: transparent; }

/* Make modal full width on very small screens */
@media (max-width: 640px) {
	.modal { width: 98%; height: 96vh; border-radius: 8px; }
	.modal-body { padding: 12px; }
}

/* Card styles shown only on small screens */
@media (max-width: 900px) {
	.history-table-wrapper { display: none; }
	.history-cards { display: block; }
	.history-card { display: block; background: #fff; border-radius: 8px; padding: 12px; box-shadow: 0 2px 8px rgba(0,0,0,0.06); margin-bottom: 12px; }
	.card-row { margin-bottom: 6px; color: #333; }
	.card-actions { display:flex; gap:8px; margin-top:8px; }
	.btn-link { background: transparent; border: none; color: #2563eb; cursor: pointer; padding: 6px 8px; }
	.btn-action { background: #d32f2f; color: #fff; border:none; padding:6px 10px; border-radius:6px; cursor:pointer; }
	.btn-action.small { padding:4px 8px; font-size:0.95em; }
}

/* Desktop buttons */
.btn-link { background: transparent; border: none; color: #2563eb; cursor: pointer; padding: 4px 6px; }
.btn-action { background: #d32f2f; color: #fff; border:none; padding:6px 10px; border-radius:6px; cursor:pointer; }
.status-done { color:#2563eb; font-weight:600; }
.error { color: #d32f2f; margin: 0.5em 0; font-weight: 500; background: none; border: none; padding: 0; }
